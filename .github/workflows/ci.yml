name: CI - Test Application

on:
  push:
    branches:
      - test

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Run Tests
        run: |
          pytest --cov=src --cov-report=term-missing

      - name: Create PR to Staging
        uses: peter-evans/create-pull-request@v5
        with:
          branch: test
          base: staging
          title: "Auto-PR: Test passed, ready for Staging"
          body: "This PR was generated automatically after tests passed on the test branch."
